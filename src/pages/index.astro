---
import { SITE_URL, SITE_AUTHOR, SITE_AUTHOR_X_URL, SITE_AUTHOR_LINKEDIN_URL } from '../consts/site';
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';

const posts = (await getCollection('blog'))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

function calculateReadingTime(content: string): number {
  const wordsPerMinute = 200;
  const words = content.split(/\s+/).length;
  return Math.ceil(words / wordsPerMinute);
}
---

<Layout>
	<script type="application/ld+json" set:html={JSON.stringify({
		"@context": "https://schema.org",
		"@type": "Person",
		"name": SITE_AUTHOR,
		"url": SITE_URL,
		"sameAs": [
			SITE_AUTHOR_X_URL,
			SITE_AUTHOR_LINKEDIN_URL
		],
		"jobTitle": "Software Developer",
		"description": "Software developer focused on building minimalist and efficient web applications, exploring AI technologies."
	})} />
	
	<script type="application/ld+json" set:html={JSON.stringify({
		"@context": "https://schema.org",
		"@type": "WebSite",
		"name": "opik.dev",
		"url": SITE_URL,
		"author": {
			"@type": "Person",
			"name": SITE_AUTHOR
		},
		"inLanguage": "en-US"
	})} />
	
	<section class="space-y-6 pt-0">
		<h1 class="text-3xl font-bold tracking-tight sm:text-4xl">
			Hi, I'm Opik.
		</h1>
		<p class="text-lg text-zinc-400 leading-relaxed max-w-2xl">
			I'm a software engineer focused on modern web development and AI integration. 
			I believe AI is leverage and will change how we build web applications and how businesses make decisions.
		</p>
		<div class="flex gap-4 flex-wrap">
			<a
				href="/blog"
				class="inline-flex items-center justify-center rounded-full bg-zinc-50 px-5 py-2.5 text-sm font-medium text-zinc-900 shadow-sm transition-all hover:bg-zinc-50/90 hover:shadow focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-400 focus-visible:ring-offset-2 focus-visible:ring-offset-zinc-950"
			>
				Read my blog
			</a>
			<a
				href="/about"
				class="inline-flex items-center justify-center rounded-full border border-zinc-800 bg-zinc-950 px-5 py-2.5 text-sm font-medium shadow-sm transition-all hover:bg-zinc-800 hover:text-zinc-50 hover:border-zinc-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-400 focus-visible:ring-offset-2 focus-visible:ring-offset-zinc-950"
			>
				About me
			</a>
		</div>
	</section>

	<section class="pt-12 mt-12 border-t border-zinc-800" aria-labelledby="latest-posts-heading">
		<div class="flex items-center justify-between mb-10">
			<h2 id="latest-posts-heading" class="text-2xl font-semibold">Latest Posts</h2>
			<a href="/blog" class="text-sm font-medium text-zinc-500 hover:text-zinc-50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-400 focus-visible:ring-offset-2 focus-visible:ring-offset-zinc-950 rounded">
				View all posts <span aria-hidden="true">&rarr;</span>
			</a>
		</div>
		
		<div class="grid gap-10">
			{posts.map((post) => {
				const readingTime = calculateReadingTime(post.body);
				return (
					<article class="group relative flex flex-col sm:flex-row gap-6 sm:items-stretch">
						{post.data.heroImage && (
							<a href={`/blog/${post.slug}/`} class="relative aspect-square w-full sm:w-40 shrink-0 overflow-hidden rounded-xl bg-zinc-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-400 focus-visible:ring-offset-2 focus-visible:ring-offset-zinc-950">
							<img
								src={post.data.heroImage}
								alt={`${post.data.title} - Featured image`}
								class="absolute inset-0 h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
								loading="lazy"
								decoding="async"
								width="160"
								height="160"
								sizes="(max-width: 640px) 100vw, 160px"
							/>
							</a>
						)}
						<div class="flex flex-col flex-1 min-w-0 justify-between">
							<div>
								<div class="flex items-center gap-2 text-sm text-zinc-400 mb-3 flex-wrap">
									<time datetime={post.data.pubDate.toISOString()}>
										{post.data.pubDate.toLocaleDateString('en-us', {
											year: 'numeric',
											month: 'short',
											day: 'numeric',
										})}
									</time>
									<span aria-hidden="true" class="text-zinc-600">â€¢</span>
									<span>{readingTime} min read</span>
								</div>
								<h3 class="text-xl font-bold group-hover:text-zinc-50 transition-colors mb-3 leading-tight line-clamp-2">
									<a href={`/blog/${post.slug}/`} class="focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-400 focus-visible:ring-offset-2 focus-visible:ring-offset-zinc-950 rounded">
										{post.data.title}
									</a>
								</h3>
								<p class="text-base text-zinc-400 line-clamp-1 leading-relaxed">
									{post.data.description}
								</p>
							</div>
							{post.data.tags && post.data.tags.length > 0 && (
								<div class="flex gap-2 flex-wrap">
									{post.data.tags.map(tag => (
										<a
											href={`/blog?tag=${tag}`}
											class="inline-flex items-center rounded-full border border-zinc-800 bg-zinc-950 px-3 py-1 text-xs font-medium text-zinc-400 transition-colors hover:bg-zinc-800 hover:text-zinc-50 hover:border-zinc-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-400 focus-visible:ring-offset-2 focus-visible:ring-offset-zinc-950"
										>
											#{tag}
										</a>
									))}
								</div>
							)}
						</div>
					</article>
				);
			})}
		</div>
	</section>
</Layout>
